# Техническое задание на разработку ИИ-продукта ISANM

## 1. Введение

**ISANM (Information System for Analysis of Nanoparticle Morphology)** — веб-система для анализа морфологии наночастиц в коллоидных структурах. Этот документ описывает функциональные, технические и ИИ-компоненты системы, а также процедуры развертывания и валидации.
 
Система iSANM предназначена для анализа коллоидных сборок с использованием различных источников данных: текстовых и графических.  
Методы анализа включают идентификацию кластеров, оценку распределения и формы частиц, а также другие методы морфологического анализа.  
Результаты анализа предоставляют исследователям количественные и визуальные данные о структурных характеристиках наночастиц, что важно для материаловедения, нанотехнологий и фундаментальных исследований.

---

## 2. Цели ИИ-продукта

* Автоматизация анализа морфологии наночастиц.
* Организация работы пользователей через тематические папки.
* Поддержка загрузки и хранения изображений (PNG, JPEG) и текстовых файлов.
* Запуск различных методов анализа, включая идентификацию кластеров.
* Сохранение результатов всех методов анализа.
* Визуализация исходных данных и результатов.

---

## 3. Пользовательские интерфейсы

| Тип интерфейса                  | Название / Элемент             | Функциональность                                                                                        |
| ------------------------------- | ------------------------------ | ------------------------------------------------------------------------------------------------------- |
| **GUI**                         | Страница логина                | Авторизация через ORCID, проверка прав пользователя                                                     |
| GUI                             | Главная страница               | Обзор всех проектов/экспериментов, навигация по системе                                                 |
| GUI                             | Глобальная папка пользователя  | Просмотр всех тематических папок, управление ими                                                        |
| GUI                             | Подпапки проекта/эксперимента  | Создание подпапок, загрузка изображений и текстовых файлов, организация данных                          |
| GUI                             | Страница методов анализа       | Выбор метода анализа, запуск обработки, просмотр и скачивание результатов                               |
| GUI                             | Страница личного кабинета      | Настройки профиля пользователя, управление авторизацией и данными                                       |
| GUI                             | Страница литературы по методам | Справочные материалы и документация по методам анализа                                                  |
| **REST API**                    | Управление папками             | Создание, удаление, переименование папок и подпапок, получение списка папок пользователя                |
| REST API                        | Работа с файлами               | Загрузка изображений и текстовых файлов, получение списка файлов, скачивание и удаление файлов          |
| REST API                        | Запуск методов анализа         | Выбор метода (например, идентификация кластеров), передача данных, получение результатов в формате JSON |
| REST API                        | Информация о пользователе      | Получение данных профиля, обновление настроек учетной записи                                            |


---

## 4. Взаимодействие с внешними системами

* **Roboflow API** — интеграция YOLOv8 для модуля идентификации кластеров.
* **MSSQL Server 2022** — хранение пользователей, папок, файлов и результатов анализа.
* **OAuth через ORCID** — авторизация пользователей.
* **Google reCAPTCHA v4** — защита страницы логина от ботов и автоматических запросов.

Также большинство методов анализа морфологии написаны на Python — интегрируются в ASP.NET Core через C# (запуск Python-скриптов из C# для обработки данных).

---

## 5. Архитектура системы и модули

**Модули системы:**

Система iSANM разделена на следующие основные подсистемы:

1. **Модуль управления данными (C# / ASP.NET Core)** — создание/управление папками, загрузка изображений и текстовых файлов, организация и хранение результатов.
2. **Модуль хранения данных** — файловое хранилище и MSSQL Server 2022.
3. **Модуль анализа (ИИ)** — основной метод: идентификация кластеров с YOLOv8 через Roboflow API; получение координат и классов объектов; возможность расширения другими методами анализа.
4. **Модуль визуализации** — генерация исходных изображений с выделенными кластерами, отображение результатов пользователю.

**Описание пайплайна:**

1. Пользователь загружает изображение через веб-интерфейс.
2. ASP.NET Core принимает изображение и управляет его передачей.
3. При необходимости выполняется предварительная обработка через Python-скрипт.
4. Изображение передаётся в Roboflow API, где работает обученная модель YOLOv8.
5. Результат обработки возвращается обратно через тот же путь: Roboflow → Python → C# → веб-интерфейс.
6. Результаты визуализируются в интерфейсе и при желании пользователя сохраняются в его тематической папке.

---

## 6. Модуль идентификации кластеров (ключевой ИИ-метод)

* **Модель:** YOLOv8 через Roboflow API
* **Функционал:** детектирование кластеров наночастиц на изображениях
* **Метрики качества:** mAP, Precision, Recall
* **Требования к данным:** аннотированные изображения PNG/JPEG + JSON/YOLO Label
* **Методы обучения:** supervised learning на подготовленном датасете

---

## 7. Методы обучения и требования к данным (для всех ИИ-методов)

* Аннотированные изображения изображений коллоидных сборок
* Формат: PNG/JPEG (для изображений) + JSON (для хранения координат полигонов кластеров)
* Объем: достаточный для достижения заданных метрик качества
* Назначение: обучение и валидация модели YOLOv8 для идентификации кластеров; набор данных также может использоваться для других методов анализа, интегрированных в систему

В качестве обучающего набора вручную был создан датасет, состоящий из примерно 6000 реальных и искусственно сгенерированных изображений коллоидных сборок

---

## 8. Валидация и тестирование

* Ручное тестирование модулей: проверка загрузки и хранения изображений и текстовых файлов
* Интеграционные тесты взаимодействия с Roboflow API
* Функциональное тестирование веб-интерфейса
* Нагрузочное тестирование при массовой загрузке файлов

---

## 9. Варианты развертывания системы

* **Основной вариант:** VDS-сервер (Linux Ubuntu)
* **Альтернатива:** Docker-контейнеризация

## 10. Процедура подготовки к развертыванию системы

1. **Подготовка сервера**
   - Настройка VDS (Windows/Linux).  
   - Установка системных пакетов и зависимостей, включая:
     - .NET SDK для ASP.NET Core
     - Python 3.x и необходимые библиотеки (numpy, scipy, opencv-python, pillow, requests, torch, ultralytics)
     - Nginx
     - Git, curl, unzip, libssl-dev и другие системные утилиты/

2. **Настройка базы данных**
   - Установка MSSQL Server 2022.
   - Создание схемы базы данных для хранения пользователей, папок, файлов и результатов анализа.

3. **Развёртывание веб-приложения**
   - Настройка Kestrel для запуска ASP.NET Core приложения.
   - Настройка обратного прокси через Nginx для обработки HTTPS-запросов.
   - Установка и привязка SSL-сертификата для безопасного соединения.
   - Настройка домена и DNS-записей для доступа к приложению по выбранному URL.

4. **Настройка внешних сервисов**
   - Конфигурация Roboflow API (API key).
   - Настройка OAuth авторизации через ORCID.

5. **Тестовый прогон системы**
   - Проверка корректной работы веб-интерфейса.
   - Проверка функциональности модулей анализа и идентификации кластеров.
   - Проверка корректной работы хранения данных и визуализации результатов.

---

## 10. Примечания

* Модуль идентификации кластеров — ключевой ИИ-компонент, остальные функции обеспечивают инфраструктуру и работу пользователей.
* Система рассчитана на исследователей и инженеров лаборатории.
* Пользователи могут работать с папками, изображениями, текстовыми файлами и результатами всех методов анализа.
